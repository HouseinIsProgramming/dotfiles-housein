[
  // ============================================================================
  // ALWAYS - not terminal
  {
    // "context": "!Terminal",
    "context": "Editor && VimControl && !VimWaiting && !menu && vim_mode != insert",
    "bindings": {
      "space f p": "projects::OpenRecent",
      "space f g": "workspace::NewSearch",
      "space f f": "file_finder::Toggle",
      "space l s": "task::Spawn",
      "cmd-shift-r": "workspace::CloseAllDocks"
    }
  },

  //  ============================================================================
  // TERMINAL CONTEXT
  // ============================================================================
  {
    "context": "Terminal",
    "bindings": {
      // Tab switching with cmd keys
      "cmd-1": ["pane::ActivateItem", 0],
      "cmd-2": ["pane::ActivateItem", 1],
      "cmd-3": ["pane::ActivateItem", 2],
      "cmd-4": ["pane::ActivateItem", 3],
      "cmd-5": ["pane::ActivateItem", 4],
      "cmd-6": ["pane::ActivateItem", 5],
      "cmd-7": ["pane::ActivateItem", 6],
      "cmd-8": ["pane::ActivateItem", 7],
      "cmd-9": ["pane::ActivateItem", 8],
      "cmd-0": "pane::ActivateLastItem",

      // Pane resizing
      "ctrl-w =": "vim::ResetPaneSizes",
      "ctrl-cmd-w ctrl-h": "vim::ResizePaneLeft",
      "ctrl-w ctrl-l": "vim::ResizePaneRight",
      "ctrl-w ctrl-k": "vim::ResizePaneUp",
      "ctrl-w ctrl-j": "vim::ResizePaneDown"
    }
  },

  // ============================================================================
  // WORKSPACE NAVIGATION (DOCK/TERMINAL/EDITOR)
  // ============================================================================
  {
    "context": "Dock || Terminal || Editor",
    "bindings": {
      "cmd-e": "project_panel::ToggleFocus",

      "cmd-k": "workspace::ToggleZoom"
    }
  },

  // ============================================================================
  // WORKSPACE GENERAL
  // ============================================================================
  {
    "context": "Workspace",
    "bindings": {}
  },

  // ============================================================================
  // GIT PANEL
  // ============================================================================
  {
    "context": "GitPanel",
    "bindings": {
      "q": "git_panel::Close"
    }
  },

  // ============================================================================
  // AGENT PANEL (AI ASSISTANT)
  // ============================================================================
  {
    "context": "AgentPanel",
    "bindings": {}
  },

  // ============================================================================
  // PROJECT PANEL (FILE EXPLORER - NETRW STYLE)
  // ============================================================================
  {
    "context": "ProjectPanel && not_editing",
    "bindings": {
      // File operations
      "a": "project_panel::NewFile",
      "A": "project_panel::NewDirectory",
      "r": "project_panel::Rename",
      "d": "project_panel::Delete",
      "i": "project_panel::CollapseAllEntries",

      // Copy/paste operations
      "x": "project_panel::Cut",
      "c": "project_panel::Copy",
      "p": "project_panel::Paste",

      // Navigation
      "j": "menu::SelectNext",
      "k": "menu::SelectPrevious",
      "h": "project_panel::CollapseSelectedEntry",
      "l": "project_panel::ExpandSelectedEntry",
      "g g": "menu::SelectFirst",
      "shift-g": "menu::SelectLast",
      "-": "project_panel::SelectParent",

      // Opening files
      "enter": ["workspace::SendKeystrokes", "o shift-cmd-r"],
      "o": "project_panel::OpenPermanent",
      "t": "project_panel::OpenPermanent",
      "v": "project_panel::OpenPermanent",

      // Panel management
      "q": "workspace::ToggleLeftDock",
      "space e": "workspace::ToggleLeftDock",
      "escape": "project_panel::ToggleFocus",

      // Other operations
      ":": "command_palette::Toggle",
      "/": "project_panel::NewSearchInDirectory",
      "ctrl-l ctrl-c": "project_panel::CollapseAllEntries",
      "ctrl-6": "pane::AlternateFile"
    }
  },

  // ============================================================================
  // EDITOR GENERAL
  // ============================================================================
  {
    "context": "Editor",
    "bindings": {
      "cmd-e": "workspace::ToggleLeftDock"
    }
  },

  // ============================================================================
  // EDITOR - VIM CONTROL (MAIN KEYBINDINGS)
  // ============================================================================
  {
    "context": "Editor && VimControl && !VimWaiting && !menu",
    "bindings": {
      // AI Assistant
      "space a a": "agent::ToggleFocus",
      "space a e": "assistant::InlineAssist",
      "space a t": "workspace::ToggleRightDock",
      "cmd-l": "assistant::InlineAssist",

      // File management
      "space f p": "projects::OpenRecent",

      // Buffer management
      "space b b": "pane::AlternateFile",
      "space b d": "pane::CloseActiveItem",
      "space b q": "pane::CloseOtherItems",
      "space b n": "workspace::NewFile",
      "space b p": "pane::TogglePinTab",
      "space ,": "tab_switcher::Toggle",
      "] b": "pane::ActivateNextItem",
      "[ b": "pane::ActivatePreviousItem",

      // Tab switching
      "space 1": ["pane::ActivateItem", 0],
      "space 2": ["pane::ActivateItem", 1],
      "space 3": ["pane::ActivateItem", 2],
      "space 4": ["pane::ActivateItem", 3],
      "space 5": ["pane::ActivateItem", 4],
      "space 6": ["pane::ActivateItem", 5],
      "space 7": ["pane::ActivateItem", 6],
      "space 8": ["pane::ActivateItem", 7],
      "space 9": ["pane::ActivateItem", 8],
      "cmd-1": ["pane::ActivateItem", 0],
      "cmd-2": ["pane::ActivateItem", 1],
      "cmd-3": ["pane::ActivateItem", 2],
      "cmd-4": ["pane::ActivateItem", 3],
      "cmd-5": ["pane::ActivateItem", 4],
      "cmd-6": ["pane::ActivateItem", 5],
      "cmd-7": ["pane::ActivateItem", 6],
      "cmd-8": ["pane::ActivateItem", 7],
      "cmd-9": ["pane::ActivateItem", 8],
      "cmd-0": "pane::ActivateLastItem",

      // Search operations
      "space s w": "buffer_search::Deploy",
      "space s W": "pane::DeploySearch",
      "space s b": "vim::Search",
      "space s g": "workspace::NewSearch",
      "space s d": "diagnostics::Deploy",
      "space s s": "outline::Toggle",

      // Git operations
      "space g g": [
        "task::Spawn",
        {
          "task_name": "start lazygit",
          "reveal_target": "center"
        }
      ],
      "space g b": "git::Blame",
      "space g h d": "editor::ExpandAllDiffHunks",
      "space g h D": "git::Diff",
      "space g h r": "git::Restore",
      "space g h R": "git::RestoreFile",

      // Code actions & LSP
      "space l a": "editor::ToggleCodeActions",
      "space l f": "editor::Format",
      "space r n ": "editor::Rename",

      // UI toggles
      "space u i": "editor::ToggleInlayHints",
      "space u w": "editor::ToggleSoftWrap",

      // Markdown
      "space m p": "markdown::OpenPreview",
      "space m P": "markdown::OpenPreviewToTheSide",

      // Panels
      "space e": "workspace::ToggleLeftDock",
      "space t": "workspace::ToggleBottomDock",

      // Window management
      "space w s": "pane::SplitDown",
      "space w v": "pane::SplitRight",
      "space -": "pane::SplitDown",
      "space |": "pane::SplitRight",
      "space w x": "pane::CloseAllItems",
      "space w q": "pane::CloseAllItems",

      // Navigation - hunks
      "] h": "editor::GoToHunk",
      "[ h": "editor::GoToPreviousHunk",
      "] c": "editor::GoToHunk",
      "[ c": "editor::GoToPreviousHunk",

      // Navigation - diagnostics
      "] d": "editor::GoToDiagnostic",
      "[ d": "editor::GoToPreviousDiagnostic",
      "] e": "editor::GoToDiagnostic",
      "[ e": "editor::GoToPreviousDiagnostic",

      // Navigation - quickfix list (vim-unimpaired style)
      "] q": "editor::MoveToStartOfNextExcerpt",
      "[ q": "editor::MoveToStartOfExcerpt",

      // Navigation - location list
      "] l": "editor::GoToHunk",
      "[ l": "editor::GoToPreviousHunk",

      // Add empty lines
      "] space": "editor::NewlineBelow",
      "[ space": "editor::NewlineAbove",

      // File manager
      "space i": [
        "task::Spawn",
        {
          "task_name": "start yazi",
          "reveal_target": "center"
        }
      ],

      // Quit
      "space q q": "zed::Quit"
    }
  },

  // ============================================================================
  // EDITOR - VIM NORMAL MODE
  // ============================================================================
  {
    "context": "Editor && vim_mode == normal && !VimWaiting && !menu",
    "bindings": {
      "space o": ["tab_switcher::Toggle", {}],

      // LSP bindings
      "g r n": "editor::Rename",
      "g r r": "editor::FindAllReferences",
      "g r i": "editor::GoToImplementation",
      "g shift-o": "outline::Toggle",
      "g r a": "editor::ToggleCodeActions"
    }
  },

  {
    "context": "Editor && vim_mode == normal && !menu",
    "bindings": {
      "ctrl-g e": "git_panel::ToggleFocus",
      "ctrl-s": "workspace::Save",
      "g p": "diagnostics::Deploy"
    }
  },

  // ============================================================================
  // EDITOR - VIM INSERT MODE
  // ============================================================================
  {
    "context": "Editor && vim_mode == insert && !menu",
    "bindings": {
      "ctrl-l": "editor::ShowCompletions",
      "ctrl-a": "editor::MoveLeft",
      "ctrl-x ctrl-a": "editor::AcceptEditPrediction",
      "ctrl-x ctrl-w": "editor::AcceptPartialEditPrediction",
      "ctrl-s": "editor::ShowSignatureHelp",
      "k j": "vim::SwitchToNormalMode"
    }
  },

  // ============================================================================
  // EDITOR - VIM VISUAL MODE
  // ============================================================================
  {
    "context": "vim_mode == visual",
    "bindings": {
      "space g s": "vim::PushAddSurrounds",
      "space g d": "vim::PushDeleteSurrounds",
      "space g c": "vim::PushChangeSurrounds"
    }
  },

  {
    "context": "Editor && vim_mode == visual && !VimWaiting && !VimObject",
    "bindings": {
      "shift-j": "editor::MoveLineDown",
      "shift-k": "editor::MoveLineUp"
    }
  },

  // ============================================================================
  // VIM CONTROL GENERAL (SCROLLING & NAVIGATION)
  // ============================================================================
  {
    "context": "VimControl && !menu",
    "bindings": {
      // Centered scrolling
      "ctrl-d": ["workspace::SendKeystrokes", "ctrl-d z z"],
      "ctrl-u": ["workspace::SendKeystrokes", "ctrl-u z z"],
      "n": ["workspace::SendKeystrokes", "n z z z v"],
      "shift-n": ["workspace::SendKeystrokes", "shift-n z z z v"],
      "shift-g": ["workspace::SendKeystrokes", "shift-g z z"],

      // References
      "g r r": "editor::FindAllReferences",

      // Project symbols
      "space f s": "project_symbols::Toggle",

      // Page navigation (legacy bindings)
      "vimScrollDown": "vim::PageDown",
      "vimScrollUp": "vim::PageUp"
    }
  },

  // ============================================================================
  // VIM OPERATORS
  // ============================================================================
  {
    "context": "vim_operator == d",
    "bindings": {
      "o": "editor::ExpandAllDiffHunks",
      "r": "git::Restore"
    }
  },

  {
    "context": "vim_operator == a || vim_operator == i || vim_operator == cs",
    "bindings": {
      "b": "vim::AnyBrackets",
      "q": "vim::AnyQuotes",
      "c": "vim::CurlyBrackets",
      "t": "vim::AngleBrackets"
    }
  },

  // ============================================================================
  // VIM MOTION MODES (NORMAL/VISUAL)
  // ============================================================================
  {
    "context": "vim_mode == normal || vim_mode == visual",
    "bindings": {
      "s": "vim::PushSneak",
      "S": "vim::PushSneakBackward"
    }
  }
]
